#!/usr/bin/env bash
set -o pipefail
[ -z "$DEBUG" ] || set -x

counter=0
state=$(systemctl status | sed -n "s/^[[:space:]]\+State: \(.*\)$/\1/p")
echo -n "System $state"

if [ "${state}" != "running" ]
then
    echo -n ", failing: " 
    systemctl --plain list-units | awk '{ if ($3 == "failed") printf("%s ",$1) }'
    counter=$((counter+1))
fi
echo
echo "${counter}"
exit ${counter}

